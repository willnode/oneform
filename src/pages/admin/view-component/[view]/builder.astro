---
import Layout from "@/layouts/Layout.astro";
import BuilderView from "./_builder";
import { notFound } from "@/components/helper";
import { getTeam } from "@/lib/auth";
import query from "@/lib/query";
const { view: id } = Astro.params;

if (!id) {
    return notFound();
}

const teamId = await getTeam(Astro.request);
if (!teamId) {
  return backToLogin();
}

const view = await query.getViewComponentById(id);
if (!view || view.teamId != teamId) {
  return notFound();
}

---

<Layout title="New View">
    <BuilderView id={id} schema={view.schema} config={view.config} client:only="react" />
    <script type="module" src="/component-client.js"></script>
</Layout>

